<html>
<head>
	  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
		 <script type="text/javascript" src="//unpkg.com/angular-js-xlsx/angular-js-xlsx.js"></script>
	<script lang="javascript" src="node_modules/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>
<body ng-app="MyApp" style="padding:50px 0 0 250px; overflow:auto;">
  <div class="w3-col m8  w3-card"  ng-controller="myController">
    <div class="w3-container w3-blue">
  <h2>Input Form</h2>
</div>
   <form class="w3-container">
    <js-xls onread="read" onerror="error"></js-xls>
  <p>
  <label>Name</label>
  <input class="w3-input" type="text" ng-bind="name"></p>
  <p>
  <label>Last Name</label>
  <input class="w3-input" type="text"></p>
  <p>
  <label>Email</label>
  <input class="w3-input" type="text"></p>
</form>
     <div class="hc-pie" items="items"></div>

</div>
   
 <script type="text/javascript">


   var myapp= angular.module('MyApp', ['angular-js-xlsx']).directive('hcPie', function () {
    return {
        restrict: 'C',
        replace: true,
        scope: {
            items: '='
        },
        controller: function ($scope, $element, $attrs) {
            console.log(2);

        },
        template: '<div id="container" style="margin: 0 auto">not working</div>',
        link: function (scope, element, attrs) {
            console.log(3);
            var chart = new Highcharts.Chart({
                chart: {
                    renderTo: 'container',
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    text: 'test'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage}%</b>',
                    percentageDecimals: 1
                },
                plotOptions: {
                    pie: {
                        animation:true,
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            color: '#000000',
                            connectorColor: '#000000',
                            formatter: function () {
                                return '<b>' + this.point.name + '</b>: ' + this.percentage + ' %';
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Browser share',
                    data: scope.items
                }]
            },function(chart){
                // $('#addPoint').click(function(){
                //     chart.series[0].addPoint(1);
                // });
            });
            
            scope.$watch("items", function (newValue) {
                chart.series[0].setData(newValue, true);
            }, true);

        }
    }
});
    myapp.controller('myController', function($scope) {
    
      $scope.read = function (workbook) {
    
        console.log(workbook);
        var first_sheet_name = workbook.SheetNames[0];
        var worksheet = workbook.Sheets[first_sheet_name];
        console.log(worksheet);
        $scope.data=[{name:worksheet['B2'].v,y:worksheet['B6'].v*100},{name:worksheet['C2'].v,y:worksheet['C6'].v*100}];
        $scope.items=$scope.data;
      }
      $scope.error = function (e) {
        /* DO SOMETHING WHEN ERROR IS THROWN */
        console.log(e);
      }
    });
    
  </script>
</html>